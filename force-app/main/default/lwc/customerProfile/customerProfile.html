<template>
    <div class="slds-page-header slds-page-header_record-home">
        <div class="slds-page-header__row">
            <div class="slds-page-header__col-title">
                <div class="slds-media">
                    <div class="slds-media__figure">
                        <span>
                            <lightning-icon icon-name="standard:announcement" alternative-text="Approved" ></lightning-icon>
                        </span>
                    </div>
                <div class="slds-media__body">
            <div class="slds-page-header__name">
            <div class="slds-page-header__name-title">
                <h1>
                    <span>Customer</span>
                    <span class="slds-page-header__title slds-truncate" title={ParentMessage.FirstName}>{ParentMessage.FirstName} {ParentMessage.LastName}</span>
                </h1>
            </div>
            
        </div>
        <div class="slds-float_right">
            <button class="slds-button slds-button_neutral">Delete</button>
        </div>
        <div class="slds-float_right">
            <button class="slds-button slds-button_neutral">Edit</button>
        </div>                
    </div>

    </div>
    </div>
    </div>

    <div class="slds-page-header__row slds-page-header__row_gutters">
        <div class="slds-page-header__col-details">
            <ul class="slds-page-header__detail-row">
                <li class="slds-page-header__detail-block">
                    <div class="slds-text-title slds-truncate" title="Field 1">Unified Individual ID</div>
                    <div class="slds-truncate" title="Unified Individual Id">{ParentMessage.Id}</div>
                </li>
            </ul>
        </div>
        <div class="slds-page-header__col-details">
            <ul class="slds-page-header__detail-row">
                <li class="slds-page-header__detail-block">
                    <div class="slds-text-title slds-truncate" title="Field 1">Created</div>
                    <div class="slds-truncate" title="Unified Individual Id">{createdDate}</div>
                </li>
            </ul>
        </div>
        <div class="slds-page-header__col-details">
            <ul class="slds-page-header__detail-row">
                <li class="slds-page-header__detail-block">
                    <div class="slds-text-title slds-truncate" title="Field 1">Updated</div>
                    <div class="slds-truncate" title="Unified Individual Id">{createdDate}</div>
                </li>
            </ul>
        </div>
        <div class="slds-page-header__col-details">
            <ul class="slds-page-header__detail-row">
                <li class="slds-page-header__detail-block">
                    <div class="slds-text-title slds-truncate" title="Field 1">Sources (9)</div>
                    <div class="slds-truncate" title="Unified Individual Id">NTO Marketing(3), NTO Stores(5), Service NTO(1)</div>
                </li>
            </ul>
        </div>                        
    </div>
    </div>

    <div class="c-container">
        <template if:false={refresh}>
            <lightning-layout>
                <div class="slds-var-p-left_small">                
                    <lightning-layout-item size="12" padding="around-small"> 
                        <lightning-card variant="Narrow"  title="Fetching CDP Data, please be patient">
                            <lightning-formatted-text
                                value="All the CDP components are fetched asynchronously from CDP backend, as each components return data "                        
                            >
                            </lightning-formatted-text>
                            <lightning-formatted-text
                                value="salesforce objects get populated, queried and displayed here. Since it takes time, during demo please pre load this page. "                        
                            >
                            </lightning-formatted-text>
                            <p>
                                This card will automatically dissappear once data fetching is over.
                            </p>                        
                        </lightning-card>
                    </lightning-layout-item>
                </div> 
            </lightning-layout>
        </template>

        <lightning-layout>

            <lightning-layout-item size="5" padding="around-small">                
                <lightning-card variant="Narrow"  title="Lifetime Value" icon-name="custom:custom66">
                    <div class="slds-scrollable" style="height:10rem;width:rem">
                        <template if:false={refresh}>
                            <div class="slds-var-p-left_small">
                                <lightning-layout-item padding="around-small">
                                    <lightning-dynamic-icon 
                                        type="eq" 
                                        alternative-text="eq intelligence">
                                    </lightning-dynamic-icon>
                                </lightning-layout-item>
                                <lightning-layout-item padding="around-small">
                                    <p>Please be patient, fetching LTV data</p>
                                </lightning-layout-item>
                            </div>

                        </template>
                        <template if:true={refresh}>
                                <div class="slds-var-p-left_xxx-small slds-var-p-top_large">
                                <lightning-layout>
                                    <lightning-layout-item>
                                        <div class="header-column">
                                            <p class="field-title-1" title="Lifetime Spend">Lifetime Spend</p>
                                            <div class="slds-var-p-top_medium">
                                                <p><lightning-formatted-number class="field-ltv" value={LifeTimeSpend} format-style="currency" currency-code="USD"></lightning-formatted-number></p>
                                            </div>
                                            
                                        </div>                            
                                    </lightning-layout-item>
            
                                    <lightning-layout-item>
                                        <div class="header-column">
                                            <p class="field-title-1" title="Lifetime Orders">Lifetime Orders</p>
                                            <p class="field-ltv slds-var-p-top_medium">{LifeTimeOrders}</p>
                                        </div>                            
                                    </lightning-layout-item>
            
                                    <lightning-layout-item>
                                        <div class="header-column">
                                            <p class="field-title-1" title="Avg Order Amount">Avg Order Amount</p>
                                            <div class="slds-var-p-top_medium">
                                                <p><lightning-formatted-number class="field-ltv" value={AvgOrderAmount} format-style="currency" currency-code="USD"></lightning-formatted-number></p>
                                            </div>
                                            
                                        </div>                            
                                    </lightning-layout-item>
                                    
                                    <lightning-layout-item>
                                        <div class="header-column">
                                            <p class="field-title-1" title="Lifetime Orders">Highest Order Amount</p>
                                            <div class="slds-var-p-top_medium">
                                                <p><lightning-formatted-number class="field-ltv" value={HighestOrderAmount} format-style="currency" currency-code="USD"></lightning-formatted-number></p>
                                            </div>
                                        </div>                            
                                    </lightning-layout-item>
            
                                    <lightning-layout-item>
                                        <div class="header-column">
                                            <p class="field-title-1" title="Lifetime Orders">Lowest Order Amount</p>
                                            <div class="slds-var-p-top_medium">
                                                <p><lightning-formatted-number class="field-ltv" value={LowestOrderAmount} format-style="currency" currency-code="USD"></lightning-formatted-number></p>
                                            </div>
                                            
                                        </div>                            
                                    </lightning-layout-item>
        
                                </lightning-layout>                    
                            </div>
                        </template>
                    </div>



                </lightning-card>
                
            </lightning-layout-item>

            <lightning-layout-item size="2" padding="around-small">
                <lightning-card variant="Narrow"  title="Loyalty Profile" icon-name="custom:custom68">
                    <div style="height:20px;margin:10px;margin-bottom:150px;">
                        <div class="lgc-bg">
                            <lightning-tile>
                                <lightning-layout horizontal-align={horizontalAlign}>
                                    <lightning-layout-item size="4" padding="around-small">
                                            <p class="field-title-2" title="Points">Points</p>                    
                                    </lightning-layout-item>
                                    <lightning-layout-item  padding="around-small">
                                        <p class="slds-text-heading_medium">{ParentMessage.LoyaltyPoints}</p>
                                    </lightning-layout-item>
                                </lightning-layout>
                            </lightning-tile>

                        </div>

                        <lightning-layout horizontal-align={horizontalAlign}>
                            <lightning-layout-item size="4" padding="around-small">
                                    <p class="field-title-2" title="Tier">Tier</p>                    
                            </lightning-layout-item>
                            <lightning-layout-item padding="around-small">
                                <p class="slds-text-heading_medium">{ParentMessage.LoyaltyStatus}</p>
                            </lightning-layout-item>
                        </lightning-layout>                        
                    </div>                    
                </lightning-card>
            </lightning-layout-item>

            <lightning-layout-item size="5" padding="around-small">
                <lightning-card variant="Narrow" title="Customer Preferences" icon-name="standard:account">
                    <div class="slds-text-heading_medium" style="height:20px;margin:10px;margin-bottom:150px;">
                        <lightning-layout>
                            <lightning-layout-item>
                                <div class="header-column">
                                    <p class="field-title" title="Contact Point">Contact Point</p>
                                    

                                    <div class="lgc-bg">
                                        <lightning-tile>
                                            <template if:true={showPhoneData}>
                                                <lightning-layout>
                                                    <lightning-layout-item padding="around small">
                                                        <lightning-formatted-phone value={ParentMessage.Phone}></lightning-formatted-phone>
                                                    </lightning-layout-item>                                                                                                
                                                </lightning-layout>
                                            </template>

                                        </lightning-tile>
                                    </div>

                                    <template if:true={showEmailData}>
                                        <lightning-tile>
                                            <lightning-layout>
                                                <lightning-layout-item padding="around small">
                                                    <lightning-formatted-email value={ParentMessage.Email} hide-icon></lightning-formatted-email>
                                                </lightning-layout-item>                                                                                                
                                            </lightning-layout>                                        
                                        </lightning-tile>
                                    </template>

                                    <template if:true={showAddressData}>
                                        <div class="lgc-bg">
                                            <lightning-tile>
                                                <lightning-layout>
                                                    <lightning-layout-item padding="around small">
                                                        <p><lightning-formatted-address
                                                            street={ParentMessage.Address1}
                                                            city={ParentMessage.City}
                                                            country={ParentMessage.Country}
                                                            province={ParentMessage.State}
                                                            postal-code={ParentMessage.PostalCode}
                                                        ></lightning-formatted-address></p>
                                                    </lightning-layout-item>
                                                </lightning-layout>
    
                                            </lightning-tile>
                                        </div>
                                    </template>



                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item>
                                <div class="header-column">
                                    <p class="field-title" title="Status">Status</p>
                                    <template if:true={showPhoneData}>
                                        <p>Opt-In</p>
                                    </template>
                                    <template if:true={showEmailData}>
                                        <p class="slds-p-top_xxx-small">Opt-In</p>
                                    </template> 
                                    <template if:true={showAddressData}>
                                        <p class="slds-p-top_x-small">Opt-In</p>
                                    </template>                                                                       
                                    
                                </div>
                            </lightning-layout-item>                        
                        </lightning-layout>                    
                    </div>                    
                </lightning-card>
            </lightning-layout-item>
        </lightning-layout>

    </div>

    <!-- Commenting out to fix the queries -->
    <div class="c-container">
        <lightning-layout>
            
            <lightning-layout-item size="4" padding="around-small">
                <c-recent-sales-order></c-recent-sales-order>
            </lightning-layout-item>

            <lightning-layout-item size="4" padding="around-small">
                <c-segment-membership></c-segment-membership>
            </lightning-layout-item>

            <lightning-layout-item size="4" padding="around-small">
                <c-engagement-timeline></c-engagement-timeline>                    
            </lightning-layout-item>            

        </lightning-layout>
    </div>


    

</template>